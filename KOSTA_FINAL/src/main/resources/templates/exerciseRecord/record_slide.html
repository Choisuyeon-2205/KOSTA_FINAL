<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.css" />
<link rel="stylesheet"
	href="https://unpkg.com/swiper/swiper-bundle.min.css" />
<script src="https://unpkg.com/swiper/swiper-bundle.js"></script>
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script th:inline="javascript">
var today = new Date();   
var date = today.getDate();
	
$(function () {
	
	var swiper = new Swiper('.swiper-container', {
		  slidesPerView: 3,
		  spaceBetween: 10,
		  initialSlide: date - 2,
		  mousewheel: {
			    invert: false,
			  },
		  scrollbar: {
		    el: '.swiper-scrollbar',
		  },
		});
	//console.log(swiper.activeIndex);
	fillUpPage();

	var modalCard = $(".item")[date-1];
	
	$(modalCard).click(function() {
		var recImage = $($(".recImage")[date-1]).attr("src");
		var p1val = $($(".p1")[date-1]).text();
		var p2val = $($(".p2")[date-1]).text();
		var p3val = $($(".p3")[date-1]).text();

		$("#myModal").modal(); // ì´ìœ ëŠ” ëª¨ë¥´ì§€ë§Œ show()ê°€ ì•ˆë˜ê³  modal() í•´ì•¼ ë¨
		if (p2val == "" && p3val == "") {
			$("input[name='exerciseType']").val("");
			$("input[name='exerciseTime']").val("");
			$("#exercise_image").val("");
			$(".modal-title").text("ì˜¤ëŠ˜ì˜ ìš´ë™ ì¸ì¦");
	 	} else {
			$("#recordInsertBtn").text("ìˆ˜ì •");
			$("#exercise_type").val(p2val); // ì•„ì´ë””ë¡œ ì„ íƒí–ˆì„ ë•Œë§Œ ê°’ì´ ë°”ë€œ			
			$("input[name='exerciseTime']").val(p3val);
			$(".modal-title").text("ìš´ë™ì¸ì¦ ìˆ˜ì •/ì‚­ì œ"); 
		}
		
		$("#recordInsertBtn").click(function() {
			uploadImage();
		})
		
		$("#recordDeleteBtn").click(function() {
			location.href = "./deleteRecord?delDate=" + p1val;
		});
	});	
})

// ì²«ë²ˆì§¸ ì¹´ë“œì˜ p1 í´ë˜ìŠ¤ ë‚ ì§œë¥¼ parsingí•´ ì´ë²ˆ ë‹¬ì˜ ì‹œì‘ ì¼ìë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜
function getPageDate(){
	let dateString = $($(".p1")[0]).text();
	dateString = Date.parse(dateString);
	let pageDate = new Date(dateString);
    return pageDate;
}

// getPageDate í•¨ìˆ˜ë¥¼ í†µí•´ ì–»ì€ ë‚ ì§œì—ì„œ í•œ ë‹¬ì„ ëº€ ë‚ ì§œë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì£¼ëŠ” í•¨ìˆ˜
function oneMonthBefore() {
	let oneMonthAgo = new Date(getPageDate().setMonth(getPageDate().getMonth() - 1));
	    let year = oneMonthAgo.getFullYear();
    let month = 1 + oneMonthAgo.getMonth();
    month = month < 10 ? '0' + month : month;
    let day = oneMonthAgo.getDate();
    day = day < 10 ? '0' + day : day; 
    location.href = "./records?startDate=" + year + "-" + month + "-" + day;
}
	
// getPageDate í•¨ìˆ˜ë¥¼ í†µí•´ ì–»ì€ ë‚ ì§œì—ì„œ í•œ ë‹¬ì„ ë”í•œ ë‚ ì§œë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì£¼ëŠ” í•¨ìˆ˜
function oneMonthAfter() {
	let oneMonthLater = new Date(getPageDate().setMonth(getPageDate().getMonth() + 1));
	    let year = oneMonthLater.getFullYear();
    let month = 1 + oneMonthLater.getMonth();
    month = month < 10 ? '0' + month : month;
    let day = oneMonthLater.getDate();
    day = day < 10 ? '0' + day : day;
    
    let today = new Date();   
    let today_year = today.getFullYear();
    let today_month = 1 + today.getMonth();
    today_month = today_month < 10 ? '0' + today_month : today_month;
    
    if (year + "-" + month + "-" + day == today_year + "-" + today_month + "-01") {
		location.href = "./records";    	
    } else {
	    location.href = "./records?startDate=" + year + "-" + month + "-" + day;
    }
}

// ì „ë‹¬ë°›ì€ DBê°’ì„ ì¹´ë“œì˜ ë‚ ì§œì™€ ë¹„êµí•´ ì¼ìê°€ ê°™ìœ¼ë©´ DBê°’ì„ ì¹´ë“œ ì¹¸ì— ë„£ì–´ì£¼ëŠ” í•¨ìˆ˜
function fillUpPage() {
	 /*<![CDATA[*/
	var exRecord = /*[[${exRecord}]]*/ "";
	/*]]>*/
	var recImage = $(".recImage");
	var p1 = $(".p1");
	var p2 = $(".p2");
	var p3 = $(".p3");
	$.each(exRecord, function(i, ex) {
		let idx = 1 * ex.exerciseId.exerciseDate.substr(8, 10) - 1;
		$(recImage[idx]).attr("src", "https://kosta-server.s3.ap-northeast-2.amazonaws.com/exerciseRecord/" + ex.exerciseImage);
		$(p1[idx]).html(ex.exerciseId.exerciseDate);
		$(p2[idx]).html(ex.exerciseType);
		$(p3[idx]).html(ex.exerciseTime);
	}) 
	// ì¸ì¦ ìˆ˜ì •ì‹œ ì´ë¯¸ì§€ë¥¼ ë³„ë„ë¡œ ì˜¬ë¦¬ì§€ ì•Šì„ ê²½ìš° í˜„ì¬ íŒŒì¼ëª…ì„ ê·¸ëŒ€ë¡œ form inputì— ì €ì¥í•´ì£¼ëŠ” ì½”ë“œ
	var lastImage = $($(".recImage")[date-1]).attr("src");
	$("#exercise_image2").val(lastImage.replace(/^.*\//, ''));
}

// í¼ì„ 2ê°œë¡œ ë¶„ë¦¬í•´ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³  ê°’ì„ ì „ë‹¬í•´ì£¼ëŠ” í•¨ìˆ˜
function uploadImage() {
	var file = $('#exercise_image')[0].files[0]; // ì´ë¯¸ì§€ íŒŒì¼ ì–»ê¸°
	if (typeof file != "undefined") {
			var formData = new FormData();
			formData.append('data', file); // data ì•ˆì— íŒŒì¼ ë„£ê¸°
			formData.append('path', "exerciseRecord"); // web ì„œë²„ì— ë§Œë“¤ í´ë” ì´ë¦„
			$.ajax({
				type : 'POST',
				url : '/upload',
				data : formData,
				processData : false,
				contentType : false
			}).done(function(responseBody) {
				var fileInput = $('#exercise_image');
				var exercise_image = fileInput[0].files[0].name; // íŒŒì¼ëª… ì¶œë ¥
				$("#exercise_image2").val(exercise_image); // íŒŒì¼ëª… ì „ë‹¬í•  hidden input ê°’ ë„£ì–´ì£¼ê¸°
				$('#exform').submit();
				$("#myModal").hide();
			}).fail(function(error) {
				alert('ì „ì†¡ì‹¤íŒ¨');
			})
		} else if ($("#recordInsertBtn").text() == "ìˆ˜ì •") {
			$('#exform').submit(); // ìˆ˜ì •ì¸ë° ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ì§€ ì•Šì•˜ì„ ê²½ìš°
			$("#myModal").hide();
		} else {
		alert("ì¸ì¦ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ í•´ì£¼ì„¸ìš”!");
		$("#exercise_image").focus();
	}
}

</script>
<style>
@font-face {
	font-family: 'NEXON Lv1 Gothic OTF Bold';
	src:
		url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@2.1/NEXON Lv1 Gothic OTF Bold.woff')
		format('woff');
	font-weight: normal;
	font-style: normal;
}

html, body {
	position: relative;
	height: 100%;
	box-sizing: border-box;
}

body {
	background: #eee;
	font-family: 'NEXON Lv1 Gothic OTF Bold', Helvetica Neue, Helvetica,
		Arial, sans-serif;
	font-size: 14px;
	color: #000;
	margin: 0;
	padding: 0;
}

.swiper-container {
	/*   position: fixed;
  bottom: 50px; */
	margin-bottom: 50px !important;
	box-shadow: 0px 14px 80px rgba(34, 35, 58, 0.2);
	width: 70%;
	height: 70%;
	border-radius: 20px;
}

.swiper-slide {
	text-align: center;
	font-size: 18px;
	justify-content: center;
	align-items: center;
	display: flex;
}

.item {
	width: 65%;
	height: 70%;
    background: linear-gradient(to top left, #ff9933 0%, #ff6600 100%);
	box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
	position: relative;
	align-items: center;
	display: flex;
	justify-content: center;
	flex-direction: column;
}

.recImage {
	padding: 5px;
	background-color: rgb(255, 255, 255);
	width: 85%;
	height: 50%;
}

.swiper-pagination-bullet {
	width: 12px !important;
	height: 12px !important;
	border-radius: 5px !important;
	background: #fd3838 !important;
	transition: all 0.3s !important;
}

.bg {
	animation: slide 3s ease-in-out infinite alternate;
	background-image: linear-gradient(-35deg, #212121 50%, #FFFFFF 50%);
	bottom: 0;
	left: -50%;
	opacity: .5;
	position: fixed;
	right: -50%;
	top: 0;
	z-index: -1;
}

.recText {
	text-align: right;
	letter-spacing: 0.1em;
	font-size: 1.4em;
	display: inline-block;
	margin: 0;
	width: 70%;
}

.textBox {
	position: relative;
	width: 100%;
}

.textBox:first-of-type {
	margin-top: 30px;
}

.emoji {
	width: 30%;
	text-align: left;
	font-size: 1.5em;
}

.bg2 {
	animation-direction: alternate-reverse;
	animation-duration: 4s;
}

.bg3 {
	animation-duration: 5s;
}

.arrows {
	position: relative;
	z-index: 10;
	font-size: 2em;
	margin: 100px auto 0;
	padding: 10px;
	text-align: center;
}

.arrows p {
	display: inline;
}

.left-arrow {
	margin-right: 100px;
}

.hide {
	display: none;
}

@keyframes slide { 0% {
	transform: translateX(-25%);
	} 
	100%{
		transform: translateX(25%);
	}
}
</style>
</head>
<body>
	<div class="arrows">
		<p class="left-arrow">
			<a href="javascript:oneMonthBefore();"> <span
				class="glyphicon glyphicon-triangle-left"></span> ì´ì „ ë‹¬
			</a>
		</p>
		<p th:class="right-arrow"
			th:classappend="${startDate == null ? 'hide' : ''}">
			<a href="javascript:oneMonthAfter();"> ë‹¤ìŒ ë‹¬ <span
				class="glyphicon glyphicon-triangle-right"></span>
			</a>
		</p>
	</div>

	<!-- Modal -->
	<div id="myModal" class="modal fade" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Modal Header</h4>
				</div>
				<div class="modal-body">
					<form id="exform" action="./insertRecord" method="post">
						<div class="form-group">
							<label for="exercise_type">ìš´ë™ ìœ í˜•</label> <select
								class="form-control" id="exercise_type" name="exerciseType">
								<option value="ì¡°ê¹…/ëŸ¬ë‹">ì¡°ê¹…/ëŸ¬ë‹</option>
								<option value="í™ˆíŠ¸/ë§í”¼íŠ¸">í™ˆíŠ¸/ë§í”¼íŠ¸</option>
								<option value="í—¬ìŠ¤/PT">í—¬ìŠ¤/PT</option>
								<option value="ë“±ì‚°">ë“±ì‚°</option>
								<option value="ìˆ˜ì˜">ìˆ˜ì˜</option>
								<option value="ë†êµ¬/ì¶•êµ¬">ë†êµ¬/ì¶•êµ¬</option>
								<option value="ê¸°íƒ€">ê¸°íƒ€</option>
							</select>
						</div>
						<div class="form-group">
							<label for="exercise_time">ìš´ë™ ì‹œê°„</label>
							<input class="form-control" type="number" id="exercise_time" name="exerciseTime" placeholder="ë¶„ ë‹¨ìœ„ë¡œ ì…ë ¥">
						</div>
						<div class="form-group">
							<input class="form-control" type="hidden" id="exercise_image2" name="exerciseImage">
						</div>
					</form>
					<form onsubmit="return false;">
						<div class="form-group">
							<label for="exercise_image">ì‚¬ì§„ ë“±ë¡</label>
							<input type="file" id="exercise_image" name="exercise_image">
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" id="recordInsertBtn" class="btn btn-default">ì…ë ¥</button>
					<button type="button" id="recordDeleteBtn" class="btn btn-danger" data-dismiss="modal">ì‚­ì œ</button>
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>

		</div>
	</div>
	<div class="swiper-container">
		<div class="bg"></div>
		<div class="bg bg2"></div>
		<div class="bg bg3"></div>
		<div class="swiper-wrapper">
			<div class="swiper-slide"
				th:each="num: ${#numbers.sequence(1,lastDay)}">
				<div class="item">
					<img class="recImage"
						src=https://kosta-server.s3.ap-northeast-2.amazonaws.com/sleep.png>
					<div class="textBox">
						<span class="emoji">ğŸ“…</span>
						<p class="recText p1"
							th:text="${startDate == null? #calendars.format(#calendars.createNow(), 'yyyy-MM') : #strings.substring(startDate,0,7)} + '-' + ${num < 10 ? '0' + num : num}"></p>
					</div>
					<div class="textBox">
						<span class="emoji">ğŸƒâ€â™€ï¸</span>
						<p class="recText p2"></p>
					</div>
					<div class="textBox">
						<span class="emoji">â±</span>
						<p class="recText p3"></p>
					</div>
				</div>
			</div>
		</div>
		<!-- If we need scrollbar -->
		<div class="swiper-scrollbar"></div>
	</div>


</body>
</html>